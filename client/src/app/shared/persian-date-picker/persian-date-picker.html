<div class="flex flex-col gap-2 relative">
    <label *ngIf="label" class="text-xs font-bold text-text-main pr-1">{{ label }}</label>
    
    <div (click)="toggle()" 
         class="relative flex items-center h-12 bg-background border border-border rounded-xl cursor-pointer transition-all px-3 hover:border-primary/50 group"
         [class.ring-2]="isOpen()"
         [class.ring-primary-light]="isOpen()"
         [class.border-primary]="isOpen()">
        
        <icon name="calendar" className="w-5 h-5 text-text-muted group-hover:text-primary transition-colors ml-2"></icon>
        
        <div class="flex-1 text-sm text-text-main font-medium h-full flex items-center">
            <span *ngIf="displayValue" class="dir-ltr">{{ displayValue }}</span>
            <span *ngIf="!displayValue" class="text-text-muted/50">{{ placeholder }}</span>
        </div>

        <icon name="chevron-down" className="w-4 h-4 text-text-muted transition-transform duration-200" [class.rotate-180]="isOpen()"></icon>
    </div>

    <div *ngIf="isOpen()" 
         class="absolute top-[110%] left-0 w-72 bg-surface rounded-2xl shadow-floating border border-border/60 p-4 z-50 animate-scale-in origin-top-left">
        
        <div class="flex items-center justify-between mb-4">
            <button (click)="changeMonth(-1)" class="p-1.5 rounded-lg hover:bg-background text-text-muted hover:text-primary transition-colors">
                <icon name="chevron-right" className="w-4 h-4"></icon>
            </button>
            
            <div class="text-sm font-bold text-text-main flex gap-1">
                <span>{{ currentMonthName }}</span>
                <span class="text-primary">{{ currentYear }}</span>
            </div>

            <button (click)="changeMonth(1)" class="p-1.5 rounded-lg hover:bg-background text-text-muted hover:text-primary transition-colors">
                <icon name="chevron-left" className="w-4 h-4"></icon>
            </button>
        </div>

        <div class="grid grid-cols-7 mb-2 text-center">
            <div *ngFor="let d of weekDays" class="text-[10px] text-text-muted font-bold">{{ d }}</div>
        </div>

        <div class="grid grid-cols-7 gap-1">
            <div *ngFor="let day of calendarDays" 
                 (click)="selectDay(day)"
                 class="h-8 rounded-lg flex items-center justify-center text-xs font-medium cursor-pointer transition-all relative overflow-hidden"
                 [ngClass]="{
                    'text-text-muted/30 pointer-events-none': !day.isCurrentMonth,
                    'hover:bg-primary/10 hover:text-primary': day.isCurrentMonth && !day.isSelected,
                    'bg-primary text-white shadow-md shadow-primary/30': day.isSelected,
                    'text-primary font-bold border border-primary/30': day.isToday && !day.isSelected
                 }">
                {{ day.dayNum }}
            </div>
        </div>

        <div class="mt-3 pt-3 border-t border-border/40 flex justify-center">
            <button (click)="selectDay({isCurrentMonth: true, dateObj: currentViewDate})" class="text-xs text-primary font-bold hover:underline">
                برو به امروز
            </button>
        </div>
    </div>
</div>