<div class="min-h-screen flex flex-col sm:items-center sm:justify-center bg-surface sm:bg-background p-0 sm:p-4 relative overflow-hidden font-sans transition-colors duration-300" dir="rtl">
    
    <div class="hidden sm:block absolute top-[-10%] left-[-5%] w-96 h-96 bg-primary/10 rounded-full blur-3xl -z-0 pointer-events-none"></div>
    
    <div class="w-full h-full sm:h-auto sm:max-w-[420px] bg-surface sm:rounded-lg shadow-none sm:shadow-card p-6 sm:p-8 relative z-10 border-none sm:border sm:border-border/50 flex flex-col justify-center animate-fade-in">
        
        <div class="flex items-center gap-2 mb-6 sm:hidden">
            <button (click)="goBack()" class="p-2 -mr-2 rounded-full hover:bg-gray-100 transition-colors">
                <icon name="arrow-right" className="w-5 h-5 text-text-muted"></icon>
            </button>
            <span class="text-sm font-bold text-text-main">
                {{ currentStep === 1 ? 'بازیابی رمز عبور' : 'تغییر رمز عبور' }}
            </span>
        </div>

        <div class="text-center mb-8 sm:mb-8 mt-4 sm:mt-0">
            <div class="inline-flex items-center justify-center w-20 h-20 sm:w-16 sm:h-16 bg-orange-50 text-orange-500 rounded-full mb-4 transition-all duration-300">
                <icon [name]="currentStep === 1 ? 'key' : 'lock-closed'" className="w-10 h-10 sm:w-8 sm:h-8"></icon>
            </div>
            <h1 class="text-2xl sm:text-2xl font-bold text-text-main mb-2">
                {{ currentStep === 1 ? 'فراموشی رمز عبور' : 'کد تایید و رمز جدید' }}
            </h1>
            <p class="text-text-muted text-xs leading-relaxed px-4">
                @if (currentStep === 1) {
                    لطفاً شماره پرسنلی خود را وارد کنید. لینک بازیابی رمز عبور برای شما ارسال خواهد شد.
                } @else {
                    کد پیامک شده را وارد کنید و رمز عبور جدید خود را تعیین نمایید.
                }
            </p>
        </div>

        @if (currentStep === 1) {
            <form [formGroup]="entityForm" (ngSubmit)="submitRecovery()" class="space-y-6 w-full animate-slide-up">
                <div class="space-y-1.5">
                    <label class="block text-sm font-medium text-text-main">شماره پرسنلی</label>
                    <div class="relative group">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-text-light group-focus-within:text-primary transition-colors">
                            <icon name="user" className="w-5 h-5"></icon>
                        </div>
                        <input type="text" inputmode="numeric" formControlName="personnelCode" class="block w-full rounded-md border-0 py-3.5 sm:py-3 pr-10 pl-3 text-text-main ring-1 ring-inset ring-border bg-background focus:outline-none focus:ring-2 focus:ring-primary transition-all text-base sm:text-sm shadow-sm placeholder:text-text-light" placeholder="مثال: 123456">
                    </div>
                    <div *ngIf="entityForm.get('personnelCode')?.touched && entityForm.get('personnelCode')?.invalid" class="text-xs text-accent flex items-center gap-1 mt-1">
                        <icon name="exclamation-circle" className="w-3.5 h-3.5"></icon>
                        <span *ngIf="entityForm.get('personnelCode')?.hasError('required')">{{ validationMessages.personnelCode.required }}</span>
                        </div>
                </div>

                <div class="flex flex-col gap-3 pt-2">
                    <button type="submit" [disabled]="entityForm.invalid" class="w-full flex justify-center items-center py-3.5 sm:py-3 px-4 border border-transparent rounded-md shadow-sm text-base sm:text-sm font-bold text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-[0.98]">
                        ارسال لینک بازیابی
                    </button>
                    <button type="button" (click)="goBack()" class="w-full flex justify-center items-center py-3.5 sm:py-3 px-4 border border-border rounded-md text-base sm:text-sm font-bold text-text-muted hover:bg-gray-50 focus:outline-none transition-all hidden sm:flex">
                        بازگشت به ورود
                    </button>
                </div>
            </form>
        }

        @if (currentStep === 2) {
            <form [formGroup]="resetForm" (ngSubmit)="submitResetPassword()" class="space-y-5 w-full animate-slide-up">
                
                <div class="space-y-1.5">
                    <label class="block text-sm font-medium text-text-main">کد تایید (پیامک شده)</label>
                    <input type="text" inputmode="numeric" formControlName="otpCode" class="block w-full text-center tracking-[0.5em] font-bold rounded-md border-0 py-3.5 sm:py-3 text-text-main ring-1 ring-inset ring-border bg-background focus:outline-none focus:ring-2 focus:ring-primary transition-all text-lg shadow-sm" placeholder="- - - -">
                </div>

                <div class="space-y-1.5">
                    <label class="block text-sm font-medium text-text-main">رمز عبور جدید</label>
                    <div class="relative group">
                        <input [type]="passwordFieldType" formControlName="newPassword" class="block w-full rounded-md border-0 py-3.5 sm:py-3 pr-3 pl-10 text-text-main ring-1 ring-inset ring-border bg-background focus:outline-none focus:ring-2 focus:ring-primary transition-all text-base sm:text-sm shadow-sm" placeholder="••••••••">
                        <button type="button" (click)="togglePasswordVisibility()" class="absolute inset-y-0 left-0 pl-3 flex items-center text-text-muted hover:text-text-main cursor-pointer focus:outline-none p-2">
                            <icon [name]="passwordFieldType === 'password' ? 'eye' : 'eye-slash'" className="w-5 h-5"></icon>
                        </button>
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label class="block text-sm font-medium text-text-main">تکرار رمز عبور</label>
                    <div class="relative group">
                        <input [type]="confirmPasswordFieldType" formControlName="confirmPassword" class="block w-full rounded-md border-0 py-3.5 sm:py-3 pr-3 pl-10 text-text-main ring-1 ring-inset ring-border bg-background focus:outline-none focus:ring-2 focus:ring-primary transition-all text-base sm:text-sm shadow-sm" placeholder="••••••••">
                        
                        <button type="button" (click)="toggleConfirmPasswordVisibility()" class="absolute inset-y-0 left-0 pl-3 flex items-center text-text-muted hover:text-text-main cursor-pointer focus:outline-none p-2">
                            <icon [name]="confirmPasswordFieldType === 'password' ? 'eye' : 'eye-slash'" className="w-5 h-5"></icon>
                        </button>
                    </div>
                    <div *ngIf="resetForm.get('confirmPassword')?.touched && resetForm.get('confirmPassword')?.invalid" class="text-xs text-accent flex items-center gap-1 mt-1">
                        <icon name="exclamation-circle" className="w-3.5 h-3.5"></icon>
                        <span *ngIf="resetForm.get('confirmPassword')?.hasError('required')">{{ validationMessages['confirmPassword'].required }}</span>
                    </div>
                </div>

                <div class="flex flex-col gap-3 pt-4">
                    <button type="submit" [disabled]="resetForm.invalid" class="w-full flex justify-center items-center py-3.5 sm:py-3 px-4 border border-transparent rounded-md shadow-sm text-base sm:text-sm font-bold text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-[0.98]">
                        تغییر رمز عبور
                    </button>
                    <button type="button" (click)="goBack()" class="w-full flex justify-center items-center py-3.5 sm:py-3 px-4 border border-border rounded-md text-base sm:text-sm font-bold text-text-muted hover:bg-gray-50 focus:outline-none transition-all">
                        بازگشت
                    </button>
                </div>
            </form>
        }

    </div>
</div>