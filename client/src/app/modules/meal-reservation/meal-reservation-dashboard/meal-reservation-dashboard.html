<div class="h-screen flex flex-col bg-background font-sans relative overflow-hidden" dir="rtl">
    <header class="sticky top-0 z-30 bg-surface/90 backdrop-blur-md shadow-sm border-b border-border/50 px-6 py-3 flex items-center justify-between transition-all h-[72px]">
        <div class="flex items-center gap-3 relative cursor-pointer" (click)="toggleUserDropdown($event)" #userButton>
            <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary border border-primary/20 shadow-sm">
                <icon name="user" className="w-5 h-5"></icon>
            </div>
            <div class="flex flex-col">
                <span class="text-sm font-bold text-text-main">علی محمدی</span>
                <span class="text-[10px] text-text-muted">کد پرسنلی: ۱۲۳۴۵۶</span>
            </div>
        </div>

        @if (isUserDropdownOpen) {
            <div class="absolute top-[90%] right-0 w-48 bg-surface rounded-xl shadow-floating border border-border/60 p-1.5 z-50 animate-scale-in origin-top-right flex flex-col gap-1">
                
                <div class="px-3 py-2 border-b border-border/40 mb-1">
                    <span class="text-xs font-bold text-text-main block">علی محمدی</span>
                    <span class="text-[10px] text-text-muted block mt-0.5">ali.mohammadi@example.com</span>
                </div>

                <button (click)="navigateToProfile()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-primary/5 hover:text-primary text-text-main text-xs font-medium transition-colors text-right">
                    <icon name="pencil-square" className="w-4 h-4 text-text-muted"></icon>
                    <span>ویرایش پروفایل</span>
                </button>

                <button (click)="navigateToChangePassword()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-primary/5 hover:text-primary text-text-main text-xs font-medium transition-colors text-right">
                    <icon name="key" className="w-4 h-4 text-text-muted"></icon>
                    <span>تغییر رمز عبور</span>
                </button>

                <button (click)="logout()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-red-50 hover:text-red-600 text-red-500 text-xs font-medium transition-colors text-right mt-1 border-t border-border/30 pt-2">
                    <icon name="arrow-right-on-rectangle" className="w-4 h-4"></icon>
                    <span>خروج از حساب</span>
                </button>
            </div>
        }

        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 text-text-muted bg-background/50 px-3 py-2 rounded-lg border border-border/50">
                <icon name="calendar" className="w-4 h-4 text-text-light"></icon>
                <span class="text-xs font-bold text-text-main pt-0.5">{{ currentDate }}</span>
            </div>

            <div class="hidden md:flex items-center gap-3 border-r border-border/60 pr-4 mr-1">
                <button 
                    (click)="navigateTo('reserve')"
                    class="flex items-center gap-2 py-2 px-4 rounded-md border border-primary text-sm font-bold text-primary hover:bg-primary hover:text-white transition-all duration-300 ease-spring active:scale-95 cursor-pointer">
                    <icon name="clipboard-document-list" className="w-5 h-5"></icon>
                    <span>مشاهده رزروها</span>
                </button>

                <button 
                    (click)="navigateTo('guest')"
                    class="flex items-center gap-2 py-2 px-4 rounded-md bg-dark text-white text-sm font-bold shadow-md shadow-dark/20 hover:bg-dark-hover transition-all duration-300 ease-spring active:scale-95 cursor-pointer">
                    <icon name="users" className="w-4 h-4"></icon>
                    <span>رزرو میهمان</span>
                </button>

                <div class="relative border-r border-border/60 pr-4 mr-1">
                    <button (click)="toggleAdminDropdown()" #adminButton
                            class="flex items-center gap-2 py-2 px-3 rounded-md bg-red-50 text-red-600 border border-red-100 hover:bg-red-100 transition-all active:scale-95 cursor-pointer"
                            [class.bg-red-100]="isAdminDropdownOpen">
                        <icon name="cog-6-tooth" className="w-5 h-5"></icon>
                        <span class="text-xs font-bold hidden lg:block">پنل ادمین</span>
                        <icon name="chevron-down" className="w-3 h-3 transition-transform duration-200" [class.rotate-180]="isAdminDropdownOpen"></icon>
                    </button>

                    @if (isAdminDropdownOpen) {
                        <div class="absolute top-[120%] left-0 w-48 bg-surface rounded-xl shadow-floating border border-border/60 p-1.5 z-50 animate-scale-in origin-top-left flex flex-col gap-1">
                            <div class="px-2 py-1.5 border-b border-border/40 mb-1">
                                <span class="text-[10px] text-text-muted font-bold">مدیریت سامانه</span>
                            </div>

                            <button (click)="navigateToSchedule()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                                <div class="p-1 rounded-md bg-background border border-border/50">
                                    <icon name="calendar-days" className="w-4 h-4"></icon>
                                </div>
                                <span>برنامه غذایی</span>
                            </button>

                            <button (click)="navigateToReservationsReview()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                                <div class="p-1 rounded-md bg-background border border-border/50">
                                    <icon name="clipboard-check" className="w-4 h-4"></icon>
                                </div>
                                <span>لیست رزروها</span>
                            </button>

                            <button (click)="navigateToFoodManagement()" class="cursor-pointer w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                                <div class="p-1 rounded-md bg-background border border-border/50">
                                    <icon name="clipboard-document-list" className="w-4 h-4"></icon>
                                </div>
                                <span>مدیریت غذاها</span>
                            </button>

                            <button class="w-full flex items-center gap-2 px-2 py-2 rounded-lg hover:bg-red-50 hover:text-red-500 text-text-muted text-xs font-medium transition-colors text-right cursor-not-allowed opacity-60">
                                <div class="p-1 rounded-md bg-background border border-border/50">
                                    <icon name="chart-bar" className="w-4 h-4"></icon>
                                </div>
                                <span>گزارش‌گیری (به زودی)</span>
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 md:p-6 pb-24">
        <router-outlet></router-outlet>
    </main>

<div class="shrink-0 fixed bottom-0 left-0 right-0 bg-surface border-t border-border shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] px-4 py-2 z-40 md:hidden h-[72px] flex items-center">
        <div class="w-full max-w-[420px] mx-auto grid grid-cols-3 gap-3">
            <button (click)="navigateTo('reserve')" class="cursor-pointer flex flex-col justify-center items-center gap-1 h-full rounded-xl transition-all active:scale-95 group"
                    [class.text-primary]="true"> <div class="p-1.5 rounded-lg bg-primary/5 border border-primary/20 group-active:bg-primary/20 transition-colors">
                    <icon name="clipboard-document-list" className="w-5 h-5"></icon>
                </div>
                <span class="text-[10px] font-bold">رزروها</span>
            </button>

            <div class="relative flex flex-col justify-center items-center h-full">
                <button (click)="toggleAdminDropdown($event)" #adminButton
                        class="cursor-pointer flex flex-col justify-center items-center gap-1 w-full h-full rounded-xl transition-all active:scale-95 group text-red-500">
                    <div class="p-1.5 rounded-lg bg-red-50 border border-red-100 group-active:bg-red-100 transition-colors"
                         [class.bg-red-100]="isAdminDropdownOpen">
                        <icon name="cog-6-tooth" className="w-5 h-5"></icon>
                    </div>
                    <span class="text-[10px] font-bold">ادمین</span>
                </button>

                @if (isAdminDropdownOpen) {
                    <div class="fixed bottom-20 left-1/2 -translate-x-1/2 w-56 bg-surface rounded-2xl shadow-2xl border border-border/60 p-2 z-50 animate-scale-in origin-bottom flex flex-col gap-1">
                        
                        <div class="absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-4 h-4 bg-surface border-b border-r border-border/60 rotate-45"></div>

                        <div class="px-3 py-2 border-b border-border/40 mb-1 flex items-center justify-between">
                            <span class="text-xs text-text-muted font-bold">پنل مدیریت</span>
                            <button (click)="isAdminDropdownOpen = false" class="p-1 rounded-full hover:bg-gray-100 text-text-muted">
                                <icon name="x-mark" className="w-3 h-3"></icon>
                            </button>
                        </div>

                        <button (click)="navigateToSchedule()" class="cursor-pointer w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                            <div class="p-1.5 rounded-lg bg-background border border-border/50 shadow-sm text-primary">
                                <icon name="calendar-days" className="w-4 h-4"></icon>
                            </div>
                            <span>برنامه غذایی</span>
                        </button>

                        <button (click)="navigateToReservationsReview()" class="cursor-pointer w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                            <div class="p-1.5 rounded-lg bg-background border border-border/50 shadow-sm text-primary">
                                <icon name="clipboard-check" className="w-4 h-4"></icon>
                            </div>
                            <span>لیست رزروها</span>
                        </button>

                        <button (click)="navigateToFoodManagement()" class="cursor-pointer w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-primary/5 hover:text-primary text-text-main text-xs font-bold transition-colors text-right">
                            <div class="p-1.5 rounded-lg bg-background border border-border/50 shadow-sm text-primary">
                                <icon name="clipboard-document-list" className="w-4 h-4"></icon>
                            </div>
                            <span>مدیریت غذاها</span>
                        </button>

                        <button class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-red-50 hover:text-red-500 text-text-muted text-xs font-medium transition-colors text-right cursor-not-allowed opacity-60">
                            <div class="p-1.5 rounded-lg bg-background border border-border/50 shadow-sm">
                                <icon name="chart-bar" className="w-4 h-4"></icon>
                            </div>
                            <span>گزارش‌گیری</span>
                        </button>
                        
                    </div>
                    
                    <div class="fixed inset-0 bg-black/20 z-40 backdrop-blur-[1px]" (click)="isAdminDropdownOpen = false"></div>
                }
            </div>

            <button (click)="navigateTo('guest')" class="cursor-pointer flex flex-col justify-center items-center gap-1 h-full rounded-xl transition-all active:scale-95 group text-text-muted hover:text-text-main">
                <div class="p-1.5 rounded-lg bg-surface border border-border group-active:bg-gray-100 transition-colors">
                    <icon name="users" className="w-5 h-5"></icon>
                </div>
                <span class="text-[10px] font-medium">میهمان</span>
            </button>
        </div>
    </div>
</div>